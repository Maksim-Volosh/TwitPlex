{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My three.js app with custom model</title>
    <style>
        body { margin: 0; }
        html {
            background-color: black;
        }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script> <!-- Подключаем OrbitControls -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script> <!-- Подключаем GLTFLoader -->
    <script>
        let scene = new THREE.Scene();

        let camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 10);

        let renderer = new THREE.WebGLRenderer({alpha: true, antialias: true});
        renderer.setClearColor(0x000000, 0);
        renderer.setSize(1280, 720);

        renderer.domElement.setAttribute("id", "Minecraft3DObj");
        document.body.insertBefore(renderer.domElement, document.body.firstChild);

        let aLight = new THREE.AmbientLight(0x404040, 1.2);
        scene.add(aLight);

        let pLight = new THREE.PointLight(0xFFFFFF, 3.2);
        pLight.position.set(-10, 5, -10);
        scene.add(pLight);

        let pLight2 = new THREE.PointLight(0xFFFFFF, 10.2);
        pLight2.position.set(-10, 5, 10);
        scene.add(pLight2);

        let helper = new THREE.PointLightHelper(pLight, 1);
        scene.add(helper);
        let helper2 = new THREE.PointLightHelper(pLight2, 1);
        scene.add(helper2);

        let mixer; // Объявляем mixer в глобальной области видимости

        let loader = new THREE.GLTFLoader();
        loader.load('{% static "img/iphone_14_pro2/scene.gltf" %}', function(gltf) {
            gltf.scene.scale.set(0.3, 0.3, 0.3);
            gltf.scene.position.x = 1;
            scene.add(gltf.scene);

            if (gltf.animations && gltf.animations.length > 0) { // Проверяем наличие анимаций
                mixer = new THREE.AnimationMixer(gltf.scene);
                let action = mixer.clipAction(gltf.animations[0]);
                action.play();
            }

            animate();
        });

        let controls = new THREE.OrbitControls(camera, renderer.domElement);

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
            if (mixer) mixer.update(clock.getDelta());
        }

        let clock = new THREE.Clock();
    </script>
</body>
</html>
